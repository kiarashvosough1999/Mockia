name: master_workflow

on:
  push:
    branches: [ "add-other-way-to-build-docc" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: macos-12

    steps:

    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable

    - name: update swift
      uses: swift-actions/setup-swift@v1

    - name: checkout
      uses: actions/checkout@v3
      # with:
       # repository: ${{ github.event.pull_request.head.repo.full_name }}
       # ref: ${{ github.event.pull_request.head.ref }}

    - name: Build Documents
      run: |
        mkdir .doc_build

        build_path=".doc_build"
        docc_build=".doc_build/Build/Products/Debug-iphonesimulator/DarkRoom.doccarchive"
        swiftspm=".swiftpm"
        docs="docs"

        xcodebuild docbuild -scheme DarkRoom -derivedDataPath $build_path -destination 'platform=iOS Simulator,name=iPhone 13'

        $(xcrun --find docc) process-archive transform-for-static-hosting $docc_build --output-path $docs --hosting-base-path DarkRoom

        $echo "DocC Build Succeed"
        rm -rf $build_path
        rm -rf $swiftspm
    
    - name: Show Changes After Building Docc
      run: |
        git branch --show-current
        git status

    - name: Commit Changes
      uses: EndBug/add-and-commit@v9
      with:
        message: update document
        committer_name: GitHub Actions
        committer_email: actions@github.com
